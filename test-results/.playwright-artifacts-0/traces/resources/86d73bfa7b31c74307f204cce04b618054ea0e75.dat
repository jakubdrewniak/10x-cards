import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.DmM0KDA7.js";import{c as g,B as o}from"./button.C59U5J4T.js";import{A as S,d as T,C as F,c as $,e as E}from"./alert.DGBkt5dw.js";import{t as y}from"./index.DsAq0-jZ.js";import"./index.Br0cVbys.js";import"./index.C24GoEYG.js";function w({className:e,...n}){return t.jsx("textarea",{"data-slot":"textarea",className:g("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...n})}function A({value:e,onChange:n,error:i}){const u=e.length;return t.jsxs("div",{className:"space-y-2",children:[t.jsx(w,{value:e,onChange:l=>n(l.target.value),placeholder:"Paste your text here (1,000 - 10,000 characters)",className:"min-h-[200px] max-h-[300px] resize-y","data-testid":"generate-input-text"}),t.jsx("div",{className:"flex justify-between text-sm text-muted-foreground",children:t.jsxs("span",{children:[u.toLocaleString()," / ",1e4.toLocaleString()," characters"]})}),i&&t.jsx(S,{variant:"destructive",children:t.jsx(T,{children:i})})]})}function C({className:e,...n}){return t.jsx("div",{"data-slot":"skeleton",className:g("bg-accent animate-pulse rounded-md",e),...n})}function L({isVisible:e}){return e?t.jsxs("div",{className:"space-y-4","data-testid":"loading-indicator",children:[t.jsx(C,{className:"h-4 w-full"}),t.jsx(C,{className:"h-4 w-3/4"}),t.jsx(C,{className:"h-4 w-1/2"})]}):null}function M({flashcard:e,onAccept:n,onEdit:i,onReject:u}){const[d,l]=f.useState(!1),[x,p]=f.useState(e.front),[j,b]=f.useState(e.back),v=()=>{i(x,j),l(!1)},N=()=>{p(e.front),b(e.back),l(!1)},k=()=>{const a="border-2";switch(e.status){case"rejected":return g(a,"border-red-500");case"edited":return g(a,"border-orange-500");case"accepted":return g(a,"border-green-500");default:return""}},m=a=>a==="accept"&&e.status==="accepted"||a==="edit"&&e.status==="edited"||a==="reject"&&e.status==="rejected"?"default":"outline";return t.jsxs(F,{className:k(),children:[t.jsxs($,{className:"pt-6",children:[d?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:`front-${e.id}`,className:"text-sm font-medium mb-2 block",children:"Front"}),t.jsx(w,{id:`front-${e.id}`,value:x,onChange:a=>p(a.target.value),placeholder:"Front side of the flashcard",className:"resize-none","data-testid":`edit-front-${e.id}`})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:`back-${e.id}`,className:"text-sm font-medium mb-2 block",children:"Back"}),t.jsx(w,{id:`back-${e.id}`,value:j,onChange:a=>b(a.target.value),placeholder:"Back side of the flashcard",className:"resize-none","data-testid":`edit-back-${e.id}`})]})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2",children:"Front"}),t.jsx("p",{className:"text-sm","data-testid":`flashcard-${e.id}-front`,children:e.front}),e.status==="edited"&&e.originalFront&&t.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[t.jsx("p",{className:"font-medium",children:"Original:"}),t.jsx("p",{children:e.originalFront})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2",children:"Back"}),t.jsx("p",{className:"text-sm","data-testid":`flashcard-${e.id}-back`,children:e.back}),e.status==="edited"&&e.originalBack&&t.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[t.jsx("p",{className:"font-medium",children:"Original:"}),t.jsx("p",{children:e.originalBack})]})]})]}),t.jsx("div",{"data-testid":`flashcard-${e.id}-status`,className:"hidden",children:e.status})]}),t.jsx(E,{className:"flex justify-end gap-2 pt-4",children:d?t.jsxs(t.Fragment,{children:[t.jsx(o,{variant:"outline",onClick:N,"data-testid":`cancel-edit-${e.id}`,children:"Cancel"}),t.jsx(o,{onClick:v,"data-testid":`save-edit-${e.id}`,children:"Save"})]}):t.jsxs(t.Fragment,{children:[t.jsx(o,{variant:m("reject"),onClick:u,"data-testid":`reject-flashcard-${e.id}`,className:g(e.status==="rejected"&&"bg-red-500 text-white hover:bg-red-600"),children:"Reject"}),t.jsx(o,{variant:m("edit"),onClick:()=>l(!0),"data-testid":`edit-flashcard-${e.id}`,className:g(e.status==="edited"&&"bg-orange-500 text-white hover:bg-orange-600"),children:"Edit"}),t.jsx(o,{variant:m("accept"),onClick:n,"data-testid":`accept-flashcard-${e.id}`,className:g(e.status==="accepted"&&"bg-green-500 text-white hover:bg-green-600"),children:"Accept"})]})})]})}function B({proposals:e,onAccept:n,onEdit:i,onReject:u}){return e.length===0?null:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h2",{className:"text-xl font-semibold",children:["Generated Flashcards (",e.length,")"]}),t.jsx("ul",{className:"grid gap-4",role:"list",children:e.map(d=>t.jsx("li",{children:t.jsx(M,{flashcard:d,onAccept:()=>n(d.id),onEdit:(l,x)=>i(d.id,l,x),onReject:()=>u(d.id)},d.id)},d.id))})]})}function I({onAcceptAll:e,disabled:n,flashcardsCount:i}){return t.jsxs(o,{onClick:e,disabled:n,variant:"secondary","data-testid":"accept-all-flashcards-button",children:["Accept All (",i,")"]})}function J(){const[e,n]=f.useState({inputText:"",isLoading:!1,errorMessage:null,flashcardsProposals:[]}),[i,u]=f.useState(!1);f.useEffect(()=>{(async()=>{try{const r=await(await fetch("/api/auth/session")).json();u(!!r.session)}catch(s){console.error("Failed to check login status:",s),u(!1)}})()},[]);const d=a=>{n(s=>({...s,inputText:a,errorMessage:m(a)}))},l=async()=>{const a=m(e.inputText);if(a){n(s=>({...s,errorMessage:a}));return}try{n(h=>({...h,isLoading:!0,errorMessage:null}));const s=await fetch("/api/generations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_text:e.inputText})});if(!s.ok){const h=await s.json().catch(()=>null);throw new Error(h?.message||"Failed to generate flashcards")}const r=await s.json();if(!r.flashcards_proposals?.length)throw new Error("No flashcards were generated. Please try with different text.");n(h=>({...h,isLoading:!1,flashcardsProposals:r.flashcards_proposals.map((c,P)=>({...c,id:P+1,status:"pending"}))}))}catch(s){n(r=>({...r,isLoading:!1,errorMessage:s instanceof Error?s.message:"An unexpected error occurred"}))}},x=async()=>{e.flashcardsProposals.length!==0&&n(a=>({...a,flashcardsProposals:a.flashcardsProposals.map(s=>({...s,status:s.status==="edited"?"edited":"accepted"}))}))},p=async()=>{const a=e.flashcardsProposals.filter(s=>s.status==="accepted"||s.status==="edited");if(a.length===0){n(s=>({...s,errorMessage:"No flashcards selected for copying"}));return}try{const s=a.map(r=>`Front: ${r.front}
Back: ${r.back}
---`).join(`

`);await navigator.clipboard.writeText(s),y.success(`Successfully copied ${a.length} flashcards to clipboard!`)}catch(s){y.error("Failed to copy flashcards to clipboard"),console.error("Clipboard error:",s)}},j=async()=>{const a=e.flashcardsProposals.filter(s=>s.status==="accepted"||s.status==="edited");if(a.length===0){n(s=>({...s,errorMessage:"No flashcards selected for saving"}));return}try{n(r=>({...r,isLoading:!0,errorMessage:null}));const s=await fetch("/api/flashcards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({flashcards:a.map(r=>({front:r.front,back:r.back,source:r.status==="edited"?"ai-edited":"ai-full",generation_id:e.generationId||null}))})});if(!s.ok){const r=await s.json().catch(()=>null);throw new Error(r?.message||"Failed to save flashcards")}y.success(`Successfully saved ${a.length} flashcards!`),n(r=>({...r,inputText:"",flashcardsProposals:[],isLoading:!1,errorMessage:null,generationId:null}))}catch(s){n(r=>({...r,isLoading:!1,errorMessage:s instanceof Error?s.message:"Failed to save flashcards"}))}},b=()=>e.flashcardsProposals.every(a=>a.status!=="pending"),v=async a=>{n(s=>({...s,flashcardsProposals:s.flashcardsProposals.map(r=>r.id===a?{...r,status:"accepted"}:r)}))},N=async(a,s,r)=>{n(h=>({...h,flashcardsProposals:h.flashcardsProposals.map(c=>c.id===a?{...c,front:s,back:r,status:"edited",originalFront:c.status==="pending"?c.front:c.originalFront,originalBack:c.status==="pending"?c.back:c.originalBack}:c)}))},k=a=>{n(s=>({...s,flashcardsProposals:s.flashcardsProposals.map(r=>r.id===a?{...r,status:"rejected"}:r)}))},m=a=>a.trim()?a.length<1e3?`Text must be at least 1000 characters long (currently ${a.length})`:a.length>1e4?`Text cannot exceed 10000 characters (currently ${a.length})`:null:"Please enter some text";return t.jsx(F,{className:"p-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(A,{value:e.inputText,onChange:d,error:e.errorMessage}),t.jsx("div",{className:"flex justify-end",children:t.jsx(o,{onClick:l,disabled:e.isLoading||e.inputText.length<1e3||e.inputText.length>1e4,"data-testid":"generate-flashcards-button",children:e.isLoading?"Generating...":"Generate Flashcards"})}),t.jsx(L,{isVisible:e.isLoading}),e.flashcardsProposals.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(I,{onAcceptAll:x,disabled:!1,flashcardsCount:e.flashcardsProposals.length}),t.jsx(o,{onClick:i?j:p,disabled:!b(),variant:"default","data-testid":"save-flashcards-button",children:i?"Save Flashcards":"Copy to Clipboard"})]}),t.jsx(B,{proposals:e.flashcardsProposals,onAccept:v,onEdit:N,onReject:k}),t.jsx("div",{className:"flex justify-end mt-4",children:t.jsx(o,{onClick:i?j:p,disabled:!b(),variant:"default",size:"lg",children:i?"Save Flashcards":"Copy to Clipboard"})})]})]})})}export{J as GenerateFlashcardsPage};
